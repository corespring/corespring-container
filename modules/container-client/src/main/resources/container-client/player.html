<!doctype html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Player</title>
    <!-- build:css css/all.css -->
    <link href='http://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/app.css"/>
    <link rel="stylesheet" href="css/player.css"/>
    <!-- endbuild -->
</head>
  <body class="hide-body">
    <div id="root" class="container" ng-controller="Root">
      <div id="player-body">

      </div>
      <div id="outcome" ng-show="outcome">
          <h4>You scored: {{outcome.summary.percentage}}%</h4>
      </div>
      <hr/>
      <button ng-click="submit()" ng-disabled="session.isFinished" class="btn btn-success">Submit</button>
      <label>Attempts left: {{session.remainingAttempts !== undefined ? session.remainingAttempts : session.maxNoOfAttempts}}</label>
    </div>

    <script type="text/javascript">
      // hey Angular, we're bootstrapping manually!
      window.name = "NG_DEFER_BOOTSTRAP!";
    </script>

    <script src="bower_components/jquery/jquery.min.js"></script>
    <script src="bower_components/jquery-ui/ui/minified/jquery-ui.min.js"></script>
    <script src="bower_components/angular/angular.js"></script>
    <script src="bower_components/lodash/dist/lodash.js"></script>
    <script src="bower_components/headjs/dist/head.js"></script>

    <!-- build:js js/player.js -->
    <script src="js/common/directives/_declaration.js"></script>
    <script src="js/common/directives/ng-bind-html-unsafe.js"></script>
    <script src="js/render/controllers/_declaration.js"></script>
    <script src="js/render/controllers/root.js"></script>
    <script src="js/corespring/container/container.js"></script>
    <script src="js/render/directives/_declaration.js"></script>
    <!-- endbuild -->

    <!-- build:js js/extras.js -->
    <script src="bower_components/angular-ui/build/angular-ui.js"></script>
    <script src="bower_components/angular-dragdrop/src/angular-dragdrop.js"></script>
    <!-- endbuild -->

    <script type="text/javascript">
      $(document).ready(function(){
        console.log("load config", document.location);

        var configPath = 'player-config.json';

        $.get( configPath, function(data){
          console.log("data", data);

          var allScriptsAreLoaded = function(){

            console.log("all scripts are loaded");
            $("#player-body").html(data.xhtml);

            var playerDeps = [
              'corespring-common.directives',
              'corespring-player.controllers',
              'corespring-player.directives',
              'corespring.container',
              'ngDragDrop'
            ].concat(data.angular.dependencies);

            angular.module("corespring-player", playerDeps );
            angular.bootstrap(document, ["corespring-player"]);
            angular.resumeBootstrap();
            $("body").addClass('blend');
          };

          var allScripts = data.scripts.concat(data.css);
          console.log(allScripts);
          head.js.apply(null, allScripts);

          head.ready(function(){
              allScriptsAreLoaded();
          });
        });
      });
    </script>
</body>
</html>
