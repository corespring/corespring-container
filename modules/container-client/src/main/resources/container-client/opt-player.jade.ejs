!!! 5
html(xmlns='http://www.w3.org/1999/html')
  head
    - for c in css
      link(rel='stylesheet', href='#{c}')

  body(ng-app='corespring-player')
    .pre-loader
      #spinner
      #root.container(ng-controller='Root', dimension-propagator='')
        div(ng-controller='Main')
          div(player-control-panel='')
          div(
            corespring-player='corespring-player', 
            player-mode='player', 
            player-markup='item.xhtml', 
            player-item='item', 
            player-session='session', 
            player-outcomes='outcome')
              != xhtml

    <% for(i in scripts) { %>
    script(type='text/javascript', src='<%= scripts[i] %>')
    <% } %>

    - for j in js
      script(type='text/javascript', src='#{j}')
    
    script(type='text/javascript')
      var deps = [
      'corespring-common.services',
      'corespring-common.directives',
      'corespring-player.controllers',
      'corespring-player.directives',
      'corespring-player.services'
      ];
      var dynDeps = #{ngModules};
      angular.module("corespring-player", deps.concat(dynDeps) ).config(['$provide', function($provide) {
        $provide.decorator('PlayerService', function($delegate, $sniffer) {
            function Wrapper(){
              var inst = new $delegate();
              this.saveSession  = inst.saveSession;
              this.getScore = inst.getScore;
              this.completeResponse = inst.completeResponse;
              this.loadSession = function(onSuccess, onFailure, id) {
                var sessionJson = #{sessionJson};
                onSuccess(sessionJson);
              };
            this.loadOutcome = inst.loadOutcome;
          }
          return Wrapper;
        });
      }]);
      $(".main").addClass('blend');
