@(namespace : String, load : Call, componentSet : JsValue, smEndpoints: org.corespring.container.client.views.models.SupportingMaterialsEndpoints)

(function(){
  "use strict";

  var loadedData = null;

  angular.module('@namespace', []);

  angular.module('@namespace').factory('ComponentService', ['$http',function($http){
    return {
        loadAvailableComponents: function(onSuccess, onFailure){
          var components = @{Json.stringify(componentSet)};
          onSuccess(components);
        }
    };
  }]);

  angular.module('@namespace').factory('SupportingMaterialUrls', [function(){
    return @smEndpoints.toJsonString;
  }]);

  angular.module('@namespace').factory('ItemService', ['BaseService', function(BaseService){
    return {
      load: function(onSuccess, onFailure){
        BaseService.load(onSuccess, onFailure);
      }
    };
  }]);

  angular.module('@namespace').factory('BaseService', ['$http' ,
    function($http){

      var def = {
        /**
         * Load the item, check to see if its already loaded.
         */
        load: function(onSuccess, onFailure){
          if(loadedData){
            onSuccess(loadedData);
          } else {
            var finalUrl = '@load.url';

            if (window && window.location && window.location.search){
              finalUrl +=  window.location.search;
            }

            $http['@load.method.toLowerCase'](finalUrl)
              .success(function(data, status, headers, config){
                loadedData = data;
                onSuccess(data);
              })
              .error(function(data, status, headers, config){
                if(onFailure){
                  onFailure(data);
                }
              });
          }
        }
      };
      return def;
    }]);
})();

