@(namespace : String, load : Call, save : Call, componentSet : JsValue)

(function(){
  "use strict";

  angular.module('@namespace', []);

  angular.module('@namespace').factory('ProfileService', ['BaseService', function(BaseService){

    return {
        save: function(profile, onSuccess, onFailure, id){
            BaseService.save( "profile", profile, onSuccess, onFailure, id);
        }
    }
  }]);

  angular.module('@namespace').factory('DesignerService', ['$http', function($http){

    return {
        save: function(components, onSuccess, onFailure, id){
            BaseService.save( "components", components, onSuccess, onFailure, id);
        }
    }

  }]);


  angular.module('@namespace').factory('ItemService', ['BaseService', function(BaseService){
    return BaseService;
  }]);

  angular.module('@namespace').factory('BaseService', ['$http', function($http){

    var def = {
      load: function(onSuccess, onFailure, id){

        var finalUrl = id ? '@load.url'.replace(":id", id) : '@load.url';

        $http['@load.method.toLowerCase'](finalUrl)
          .success(function(data, status, headers, config){
            console.log("[player-services] load item successful");
            onSuccess(data);
          })
          .error(function(data, status, headers, config){
            if(onFailure){
              onFailure(data);
            }
          });
      },
      save: function(name, data, onSuccess, onFailure, id){
        var finalUrl = id ? '@save.url'.replace(":id", id) : '@save.url';
        $http['@save.method.toLowerCase'](finalUrl, item)
          .success(function(data, status, headers, config) {
            console.log("item saved succesfully")
            onSuccess(data)
          })
          .error(function(data, status, headers, config) {
            console.warn("error");
            if( onFailure ) {
              onFailure(data);
            }
          });
      },
      loadComponents: function(onSuccess, onFailure){
        var components = @{Json.stringify(componentSet)};
        onSuccess(components);
      }
    };
    return def;
  }]);
})();

